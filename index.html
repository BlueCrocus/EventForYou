<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <!-- âœ… iOS ë…¸ì¹˜/í™ˆë°” safe-area ë°˜ì˜ + iOS/Android ë·°í¬íŠ¸ ì•ˆì •í™” -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>4ì£¼ë…„ ì´ë²¤íŠ¸ ğŸ’Œ</title>

  <!-- âœ… Favicon (ìš”ì²­ ê²½ë¡œ) -->
  <link rel="icon" href="./img/wx.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="./img/wx.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="./img/wx.ico" />

  <!-- âœ… Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />
  <meta property="og:title" content="4ì£¼ë…„ ì´ë²¤íŠ¸ ğŸ’Œ" />
  <meta property="og:description" content="ë´‰íˆ¬ë¥¼ ì—´ê³  ë¯¸ë‹ˆê²Œì„ì„ í´ë¦¬ì–´í•˜ë©´ í¸ì§€ê°€ í•œ ì¡°ê°ì”© ì—´ë ¤ìš”. ë§ˆì§€ë§‰ì—” í’€ë²„ì „ ğŸ’" />
  <meta property="og:url" content="https://bluecrocus.github.io/EventForYou/" />
  <meta property="og:site_name" content="4ì£¼ë…„ ì´ë²¤íŠ¸" />
  <meta property="og:image" content="https://bluecrocus.github.io/EventForYou/og/4th.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="4ì£¼ë…„ ì´ë²¤íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€" />

  <!-- âœ… Twitter/X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="4ì£¼ë…„ ì´ë²¤íŠ¸ ğŸ’Œ" />
  <meta name="twitter:description" content="ë´‰íˆ¬ë¥¼ ì—´ê³  ë¯¸ë‹ˆê²Œì„ì„ í´ë¦¬ì–´í•˜ë©´ í¸ì§€ê°€ í•œ ì¡°ê°ì”© ì—´ë ¤ìš”. ë§ˆì§€ë§‰ì—” í’€ë²„ì „ ğŸ’" />
  <meta name="twitter:image" content="https://bluecrocus.github.io/EventForYou/og/4th.png" />

  <meta name="theme-color" content="#0b0b12" />

  <style>
    :root{
      --bg:#0b0b12;
      --paper:#ffffff;
      --ink:#151515;
      --accent:#ff4d7d;
      --accent2:#7c3aed;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    html{ -webkit-text-size-adjust: 100%; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(124,58,237,.25), transparent 55%),
        radial-gradient(1000px 700px at 80% 30%, rgba(255,77,125,.22), transparent 50%),
        radial-gradient(900px 600px at 50% 90%, rgba(255,255,255,.06), transparent 55%),
        var(--bg);
      color:#fff;
      overflow-x:hidden;

      /* âœ… iOS safe-area */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* âœ… iOS/Android 100vh ë¬¸ì œ í•´ê²° (dvh ì§€ì› ë¸Œë¼ìš°ì €ëŠ” ìë™ ì ìš©) */
    .wrap{
      min-height:100vh;
      min-height:100dvh;
      display:grid;
      place-items:center;
      padding: 20px 14px 28px;
      padding-top: calc(20px + env(safe-area-inset-top));
      padding-bottom: calc(28px + env(safe-area-inset-bottom));
    }

    .topbar{
      width:min(980px, 100%);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
      opacity:.92;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      letter-spacing:.2px;
      font-size:14px;
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(255,77,125,.12);
      flex:0 0 auto;
    }
    .hint{
      font-size:11px;
      color:rgba(255,255,255,.7);
      line-height:1.35;
      max-width: 520px;
    }

    .stage{
      width:min(980px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .stageInner{
      padding:18px;
      display:none;
      animation: fadeUp .55s ease both;
    }
    .stageInner.active{ display:block; }
    @media (max-width: 420px){
      .stageInner{ padding:14px; }
    }

    @keyframes fadeUp{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .btn{
      appearance:none;
      border:0;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight:900;
      cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 12px 26px rgba(255,77,125,.22);
      transition: transform .15s ease, filter .15s ease;
      user-select:none;
      min-height:44px; /* âœ… í„°ì¹˜ ì˜ì—­ */
      touch-action: manipulation;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.04); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn.secondary{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      box-shadow:none;
      font-weight:850;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    @media (max-width: 420px){
      .btn{ width:100%; }
    }

    /* Stage 0 - Envelope */
    .envelopeWrap{
      display:grid;
      place-items:center;
      padding:44px 18px 52px;
      text-align:center;
    }
    @media (max-width: 420px){
      .envelopeWrap{ padding: 26px 10px 34px; }
    }
    .title{
      font-size: clamp(20px, 4.6vw, 34px);
      margin:0 0 10px;
      letter-spacing:-.4px;
    }
    .sub{
      margin:0 0 22px;
      color: rgba(255,255,255,.75);
      line-height:1.6;
      font-size: 13.5px;
    }

    .envelope{
      width:min(420px, 86vw);
      aspect-ratio: 16/10;
      position:relative;
      cursor:pointer;
      transform-style:preserve-3d;
      transition: transform .6s cubic-bezier(.2,.8,.2,1);
      margin: 8px 0 18px;
    }
    .envBase{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .envGlow{
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,77,125,.35), transparent 55%),
                  radial-gradient(circle at 70% 60%, rgba(124,58,237,.30), transparent 55%);
      filter: blur(18px);
      opacity:.75;
    }
    .envFlap{
      position:absolute; left:0; right:0; top:0;
      height:58%;
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: 50% 0%;
      transition: transform .7s cubic-bezier(.2,.9,.2,1);
      border-bottom:1px solid rgba(255,255,255,.18);
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
    }
    .seal{
      position:absolute; left:50%; top:52%;
      transform: translate(-50%, -50%);
      width:74px; height:74px; border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,77,125,.95), rgba(124,58,237,.92));
      box-shadow: 0 16px 40px rgba(255,77,125,.18);
      display:grid; place-items:center;
      font-weight:900; letter-spacing:.8px;
      border:1px solid rgba(255,255,255,.35);
    }
    .seal small{ opacity:.92; font-size:14px; }

    .envelope.open{ transform: translateY(-4px) rotateX(8deg); }
    .envelope.open .envFlap{ transform: rotateX(170deg); }
    .tiny{ font-size:12px; color: rgba(255,255,255,.7); }

    /* Stage 1~3 - Letter snippets */
    .letterGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 860px){
      .letterGrid{ grid-template-columns: 1fr; }
    }

    .paper{
      background: rgba(255,255,255,.92);
      color: var(--ink);
      border-radius: var(--radius);
      padding: 18px 18px 14px;
      box-shadow: 0 20px 60px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 420px){
      .paper{ padding: 16px 14px 12px; }
    }
    .paper:before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,77,125,.10), transparent 30%, transparent 70%, rgba(124,58,237,.10));
      pointer-events:none;
    }
    .paper h2{ margin:0 0 10px; font-size:18px; letter-spacing:-.2px; }
    .paper p{ margin:0; line-height:1.8; font-size:14.5px; white-space:pre-wrap; }
    .sig{ margin-top:14px; color: rgba(21,21,21,.72); font-size:13px; }

    .sideCard{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding: 16px;
    }
    .sideCard h3{ margin:0 0 10px; font-size:14px; color: rgba(255,255,255,.88); }
    .sideCard ul{ margin:0; padding-left:18px; color: rgba(255,255,255,.78); line-height:1.8; font-size:13px; }

    /* Game */
    .gameHeader{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 14px;
    }
    .gameHeader h2{ margin:0; font-size:18px; letter-spacing:-.2px; }
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color: rgba(255,255,255,.78);
    }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
    }

    /* âœ… í•µì‹¬: ê¸°ê¸°ë³„ ìë™ ì»¬ëŸ¼/ì¹´ë“œ í¬ê¸° ìµœì í™” */
    .board{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(92px, 1fr));
      gap: 10px;
      padding: 6px 2px 10px;
    }
    @media (max-width: 360px){
      .board{
        grid-template-columns: repeat(auto-fit, minmax(82px, 1fr));
        gap: 8px;
      }
    }

    .card{
      aspect-ratio: 1 / 1.15;
      border-radius: 16px;
      perspective: 900px;
      cursor:pointer;
      user-select:none;
      position:relative;
      background: transparent;
      border:0;
      padding:0;
      touch-action: manipulation;
    }
    .cardInner{
      position:absolute; inset:0;
      border-radius: 16px;
      transform-style:preserve-3d;
      transition: transform .38s cubic-bezier(.2,.8,.2,1);
    }
    .cardFace{
      position:absolute; inset:0;
      border-radius: 16px;
      display:grid;
      place-items:center;
      backface-visibility:hidden;
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
    }
    .front{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    }
    .front .q{ font-weight:900; font-size: 20px; opacity:.9; letter-spacing:.8px; }
    .back{
      transform: rotateY(180deg);
      background: linear-gradient(135deg, rgba(255,77,125,.22), rgba(124,58,237,.18));
      border:1px solid rgba(255,255,255,.18);
      overflow:hidden;
    }

    /* âœ… ì´ë¯¸ì§€ í”„ë ˆì„: ëª¨ë“  ì‚¬ì§„ì„ ì¹´ë“œì— ìë™ ë§ì¶¤(A: cover) */
    .imgFrame{
      width: 90%;
      height: 90%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 14px 26px rgba(0,0,0,.18);
      background: rgba(255,255,255,.20);
    }
    .cardImg{
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      display: block;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    .card.flipped .cardInner{ transform: rotateY(180deg); }
    .card.matched{
      cursor:default;
      opacity:.92;
      transform: translateY(-1px);
      transition: transform .2s ease;
    }
    .card.matched .back{
      background: linear-gradient(135deg, rgba(34,197,94,.18), rgba(59,130,246,.14));
      border-color: rgba(255,255,255,.22);
    }
    .toast{
      margin-top: 10px;
      font-size: 13px;
      color: rgba(255,255,255,.8);
      min-height: 20px;
      line-height: 1.4;
    }

    /* âœ… ì¹˜íŠ¸(ì „ì²´ ê³µê°œ) */
    .card.cheat .cardInner{ transform: rotateY(180deg); }

    /* Ending */
    .ending{ padding: 34px 18px 40px; text-align:center; position:relative; overflow:hidden; }
    @media (max-width: 420px){
      .ending{ padding: 26px 12px 30px; }
    }
    .big{ font-size: clamp(20px, 4.6vw, 34px); margin: 0 0 10px; }
    .gift{
      width: min(650px, 92vw);
      margin: 12px auto 18px;
      padding: 18px;
      border-radius: 22px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      line-height:1.9;
      color: rgba(255,255,255,.86);
      font-size: 14.5px;
      text-align:left;
      white-space:pre-wrap;
      overflow-wrap: anywhere;
    }
    .confetti{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
    .piece{
      position:absolute; width: 10px; height: 16px; opacity:.9; border-radius: 3px;
      animation: fall linear forwards;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.18));
    }
    @keyframes fall{
      from{ transform: translateY(-20px) rotate(0deg); opacity:0; }
      10%{ opacity:1; }
      to{ transform: translateY(110vh) rotate(540deg); opacity:0.9; }
    }

    /* âœ… ì¹­ì°¬ ìŠ¤í‹°ì»¤ íŒì—… */
    #sticker{
      position: fixed;
      left: 50%;
      top: 18%;
      transform: translate(-50%, -10px) scale(.9);
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
      font-size: 64px;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.35));
      transition: opacity .18s ease, transform .22s cubic-bezier(.2,.8,.2,1);
    }
    #sticker.show{
      opacity: 1;
      transform: translate(-50%, 0) scale(1);
    }

    .footer{
      width:min(980px, 100%);
      margin-top: 14px;
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height: 1.4;
      padding: 0 6px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><span class="dot"></span> 4ì£¼ë…„ ì´ë²¤íŠ¸</div>
      <div class="hint">ğŸ’¡ Stage1ğŸ¥³ â†’ Stage2ğŸ˜ â†’ Stage3ğŸ‘‘ / ì‹œì‘í•˜ë©´ 1ì´ˆ ì¹˜íŠ¸!</div>
    </div>

    <main class="stage" aria-live="polite">
      <!-- Stage 0 -->
      <section class="stageInner active" id="stage0">
        <div class="envelopeWrap">
          <h1 class="title">ë´‰íˆ¬ë¥¼ ì—´ë©´, ì´ë²¤íŠ¸ ì‹œì‘ ğŸ’Œ</h1>
          <p class="sub">ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ë©´ í¸ì§€ ì¡°ê°ì´ í•˜ë‚˜ì”© ì—´ë ¤! ë§ˆì§€ë§‰ì—” í’€ë²„ì „ ğŸ’</p>

          <div class="envelope" id="envelope" role="button" tabindex="0" aria-label="ë´‰íˆ¬ ì—´ê¸°">
            <div class="envBase"><div class="envGlow"></div></div>
            <div class="envFlap"></div>
            <div class="seal"><small>OPEN</small></div>
          </div>

          <div class="row" style="justify-content:center">
            <button class="btn" id="btnOpen">ì—´ê¸°</button>
            <button class="btn secondary" id="btnSkipIntro">ë°”ë¡œê°€ê¸°</button>
          </div>
          <p class="tiny" style="margin-top:10px;">(ê²½ê³ : ì‚´ì§ ì˜¤ê¸€ ì£¼ì˜)</p>
        </div>
      </section>

      <!-- Stage 1 -->
      <section class="stageInner" id="stage1">
        <div class="letterGrid">
          <div class="paper">
            <h2>í¸ì§€ ì¡°ê° 1 / 3</h2>
            <p id="snippet1"></p>
            <div class="sig">â€” from. ì¥ë¬´ê¾¼</div>
          </div>
          <div class="sideCard">
            <h3>ğŸ® Stage 1 ë¯¸ì…˜ (4ìŒ)</h3>
            <ul>
              <li>ì¹´ë“œ 8ì¥(4ìŒ)ë§Œ ë§ì¶”ë©´ í†µê³¼!</li>
              <li>ë‡Œì•¼â€¦ í˜ë‚´ë¼â€¦ ğŸ§ âš¡</li>
              <li>í´ë¦¬ì–´í•˜ë©´ ë‹¤ìŒ í¸ì§€ ì¡°ê° í•´ê¸ˆ!</li>
            </ul>
            <div style="height:10px"></div>
            <div class="row">
              <button class="btn" id="btnToGame1">ë¯¸ë‹ˆê²Œì„ ì‹œì‘</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Stage 2 -->
      <section class="stageInner" id="stage2">
        <div class="letterGrid">
          <div class="paper">
            <h2>í¸ì§€ ì¡°ê° 2 / 3</h2>
            <p id="snippet2"></p>
            <div class="sig">â€” from. ì¥ë¬´ê¾¼</div>
          </div>
          <div class="sideCard">
            <h3>ğŸ® Stage 2 ë¯¸ì…˜ (6ìŒ)</h3>
            <ul>
              <li>ì¹´ë“œ 12ì¥(6ìŒ)â€¦ ì˜¤ì¼€ì´?</li>
              <li>í‹€ë ¤ë„ ë¨. ê·€ì—¬ì›€ìœ¼ë¡œ ë¬´íš¨ ì²˜ë¦¬ ğŸ˜Œ</li>
              <li>í´ë¦¬ì–´í•˜ë©´ ë§ˆì§€ë§‰ ì¡°ê°ê¹Œì§€!</li>
            </ul>
            <div style="height:10px"></div>
            <div class="row">
              <button class="btn" id="btnToGame2">ë¯¸ë‹ˆê²Œì„ ì‹œì‘</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Stage 3 -->
      <section class="stageInner" id="stage3">
        <div class="letterGrid">
          <div class="paper">
            <h2>í¸ì§€ ì¡°ê° 3 / 3</h2>
            <p id="snippet3"></p>
            <div class="sig">â€” from. ì¥ë¬´ê¾¼</div>
          </div>
          <div class="sideCard">
            <h3>ğŸ® Stage 3 ë¯¸ì…˜ (8ìŒ)</h3>
            <ul>
              <li>ì¹´ë“œ 16ì¥(8ìŒ) ìµœì¢… ë³´ìŠ¤!</li>
              <li>ì—¬ê¸°ê¹Œì§€ ì™”ìœ¼ë©´ ê±°ì˜ ë‹¤ í–ˆë‹¤ ğŸ˜</li>
              <li>í´ë¦¬ì–´í•˜ë©´ í’€ë²„ì „ í¸ì§€ OPEN ğŸ’Œ</li>
            </ul>
            <div style="height:10px"></div>
            <div class="row">
              <button class="btn" id="btnToGame3">ë¯¸ë‹ˆê²Œì„ ì‹œì‘</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Game Stage -->
      <section class="stageInner" id="stageGame">
        <div class="gameHeader">
          <div>
            <h2 id="gameTitle">ğŸ§  ê¸°ì–µ ë§ì¶”ê¸°</h2>
            <div class="toast" id="toast">ì¹´ë“œë¥¼ ë’¤ì§‘ì–´ ê°™ì€ ì‚¬ì§„ì„ ì°¾ì•„ë´!</div>
          </div>
          <div class="stats">
            <span class="pill">ì‹œë„: <b id="tries">0</b></span>
            <span class="pill">ë§¤ì¹­: <b id="matched">0</b> / <b id="totalPairs">0</b></span>
            <span class="pill">ì‹œê°„: <b id="time">0</b>s</span>
          </div>
        </div>

        <div class="board" id="board" aria-label="ì¹´ë“œ ë³´ë“œ"></div>

        <div class="row" style="margin-top:12px;">
          <button class="btn secondary" id="btnRestart">ë‹¤ì‹œí•˜ê¸°</button>
          <button class="btn" id="btnCheer">ì‘ì› í•œ ë§ˆë””</button>
          <button class="btn secondary" id="btnBack">í¸ì§€ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </section>

      <!-- Ending -->
      <section class="stageInner" id="stageEnd">
        <div class="ending">
          <div class="confetti" id="confetti"></div>
          <h2 class="big">í´ë¦¬ì–´! ğŸ‰ í’€ë²„ì „ í¸ì§€ OPEN</h2>
          <p style="margin:0; color:rgba(255,255,255,.78); line-height:1.7;">
            ì¶•í•˜í•´! ì´ì œ full í¸ì§€~
          </p>

          <div class="gift" id="fullLetter"></div>

          <div class="row" style="justify-content:center;">
            <button class="btn" id="btnAgain">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
          </div>
          <p class="tiny" style="margin-top:12px;">* ë‹¤ìŒ 4ì£¼ë…„ì—”â€¦ ë” í° ì´ë²¤íŠ¸? (í˜‘ë°• ì•„ë‹˜)</p>
        </div>
      </section>

      <!-- âœ… ìŠ¤í‹°ì»¤ ì˜¤ë²„ë ˆì´ -->
      <div id="sticker" aria-hidden="true"></div>
    </main>

    <div class="footer">ë„ ìœ„í•´ ë§Œë“¤ì–´ë³¸ ì‘ì€ ì´ë²¤íŠ¸</div>
  </div>

  <script>
    // =============================
    // 0) ìŠ¤í…Œì´ì§€ ì „í™˜
    // =============================
    const stages = {
      stage0: document.getElementById('stage0'),
      stage1: document.getElementById('stage1'),
      stage2: document.getElementById('stage2'),
      stage3: document.getElementById('stage3'),
      stageGame: document.getElementById('stageGame'),
      stageEnd: document.getElementById('stageEnd'),
    };

    function showStage(id){
      Object.values(stages).forEach(s => s.classList.remove('active'));
      stages[id].classList.add('active');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // =============================
    // 1) ì´ë¯¸ì§€(8ì¥) - ë ˆí¬ ë‚´ img í´ë”
    // =============================
    const ALL_IMAGES = [
      "img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg",
      "img/5.jpg","img/6.jpg","img/7.jpg","img/8.jpg",
    ];

    // =============================
    // 2) í¸ì§€ ì¡°ê°(1~2ì¤„) + í’€ë²„ì „
    // =============================
    const snippet1 = `ìš°ë¦¬ê°€ ë§Œë‚œì§€ ì–´ëŠë§ 4ë…„ì´ ëëŠ”ë°,\nì´ì   ë„ˆê°€ ì—†ëŠ” ì•ìœ¼ë¡œê°€ ì§ì‘ë„ ì•ˆê°€â€”`;
    const snippet2 = `ë‚˜ì˜ 20ëŒ€ëŠ” ì­‰ ë„ˆë¡œ ì¶”ì–µì´ ë ê±°ì•¼! \ní•­ìƒ ë‚˜ì—ê²Œ í˜ì´ ë˜ì–´ì¤˜ì„œ ê³ ë§ˆì›Œâ™¥ï¸`;
    const snippet3 = `ì‚¬ì‹¤ í¸ì§€ë¡œ ì–´ë–¤ ë‚´ìš©ì„ ì ì–´ì•¼í• ì§€ ì–´ë ¤ì› ì–´...\në‚˜ë¦„ ì—´ì‹¬íˆ í•˜ëŠ”ë° ì´ì˜ê²Œ ë´ì¡°..`;

    document.getElementById('snippet1').textContent = snippet1;
    document.getElementById('snippet2').textContent = snippet2;
    document.getElementById('snippet3').textContent = snippet3;

    const fullLetterText =
`ì•ˆë…•? ìš°ë¦¬ì˜ 4ì£¼ë…„ ì¶•í•˜í•´!
ìš°ë¦¬ê°€ 22ì‚´ì— ë§Œë‚˜ì„œ ë²Œì¨ 26ì‚´ì´ì•¼!
ëŒ€í•™ CCë¥¼ ì‹œì‘ìœ¼ë¡œ ì¡¸ì—…í•˜ê³ ë„ ì´ë ‡ê²Œ ì˜ ì§€ë‚´ê³  ìˆë‹¤ëŠ”ê²Œ ë„ˆë¬´ ì¢‹ë‹¤!

ë§ë¡œë§Œ ì¶•í•˜í•˜ê¸°ì—” ì•„ì‰¬ì›Œì„œ ê¸°ì–µì— ë‚¨ì„ë§Œí•œê²Œ ë­˜ê¹Œ ìƒê°í•˜ë‹¤ê°€
ì‘ì€ ì´ë²¤íŠ¸ ë§Œë“¤ì–´ë´¤ì–´!

ì–´ë•Œ ì¡°ê¸ˆ ê°ë™ì ì¸ê°€??
ë™ìƒí•œí…Œ ë³´ì—¬ì£¼ë‹ˆê¹Œ ëˆˆë¬¼ë‚œë‹¤ë˜ë””?

ë‚˜ë¦„ ê³µë¶€í•œê±¸ë¡œ ë„ˆì—ê²Œ ë³´ì—¬ì£¼ê³ ì‹¶ì—ˆì–´!
ì´ ê¸¸ì´ ë‚´ ê¸¸ì´ ì•„ë‹ˆë¼ë„ í•­ìƒ ì‘ì›í•´ì¤˜ì„œ ê³ ë§ˆì›Œâ™¥ï¸

ìš°ë¦¬ì˜ 4ì£¼ë…„ ì¶•í•˜í•´!
ì•ìœ¼ë¡œë„ ì˜ ë¶€íƒí•´-

ë„Œ ë‚˜ì—ê²Œ ìˆì–´ ë¹›ì´ê³ , ë‚´ êµ¬ì›ì´ì•¼!

ì‚¬ë‘í•´ìš”â™¥ï¸
`;

    document.getElementById('fullLetter').textContent = fullLetterText;

    // =============================
    // 3) ì¸íŠ¸ë¡œ(ë´‰íˆ¬)
    // =============================
    const envelope = document.getElementById('envelope');
    const btnOpen = document.getElementById('btnOpen');
    const btnSkipIntro = document.getElementById('btnSkipIntro');

    function openEnvelope(){
      envelope.classList.add('open');
      setTimeout(()=> showStage('stage1'), 650);
    }
    envelope.addEventListener('click', openEnvelope);
    envelope.addEventListener('keydown', (e)=> { if(e.key==='Enter'||e.key===' ') openEnvelope(); });
    btnOpen.addEventListener('click', openEnvelope);
    btnSkipIntro.addEventListener('click', ()=> showStage('stage1'));

    // =============================
    // 4) ìŠ¤í‹°ì»¤ íŒì—… (Stageë³„ ì´ëª¨ì§€)
    // =============================
    const stickerEl = document.getElementById('sticker');
    const STAGE_STICKER = { 1:"ğŸ¥³", 2:"ğŸ˜", 3:"ğŸ‘‘" };

    function popSticker(emoji){
      if(!stickerEl) return;
      stickerEl.textContent = emoji;
      stickerEl.classList.add('show');
      setTimeout(()=> stickerEl.classList.remove('show'), 650);
    }

    // =============================
    // 5) ê²Œì„ ê³µí†µ ë¡œì§
    // =============================
    const board = document.getElementById('board');
    const toast = document.getElementById('toast');
    const triesEl = document.getElementById('tries');
    const matchedEl = document.getElementById('matched');
    const totalPairsEl = document.getElementById('totalPairs');
    const timeEl = document.getElementById('time');
    const gameTitle = document.getElementById('gameTitle');

    const btnRestart = document.getElementById('btnRestart');
    const btnCheer = document.getElementById('btnCheer');
    const btnBack = document.getElementById('btnBack');

    const cheerMsgs = [
      "ë‡Œì•¼â€¦ ì¼í•´ë¼â€¦ ğŸ§ âš¡",
      "ì´ê±° ë§ì¶”ë©´ í’€í¸ì§€ ì—´ë¦°ë‹¤. ì§„ì§œì„. (ì•„ë§ˆë„)",
      "ì§€ê¸ˆ ë„ˆâ€¦ ì²œì¬ ëª¨ë“œ ì¼°ì§€?",
      "ì‹¤íŒ¨í•´ë„ ê·€ì—¬ì›€ìœ¼ë¡œ ìƒì‡„ë¨ ğŸ˜Œ",
      "í•œ ë²ˆë§Œ ë”! ë‚´ê°€ ë´ì¤€ë‹¤ ğŸ˜",
    ];

    let currentLetterStage = 1; // 1,2,3
    let currentPairCount = 4;

    let deck = [];
    let first = null;
    let second = null;
    let lock = false;

    let tries = 0;
    let matched = 0;
    let timer = null;
    let seconds = 0;

    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function setToast(msg){ toast.textContent = msg; }

    function resetStats(pairCount){
      tries = 0;
      matched = 0;
      seconds = 0;
      triesEl.textContent = tries;
      matchedEl.textContent = matched;
      totalPairsEl.textContent = pairCount;
      timeEl.textContent = seconds;
    }

    function stopTimer(){
      if(timer){ clearInterval(timer); timer = null; }
    }
    function startTimer(){
      stopTimer();
      timer = setInterval(()=>{
        seconds++;
        timeEl.textContent = seconds;
      }, 1000);
    }

    function buildBoard(pairCount){
      board.innerHTML = "";
      const picked = shuffle(ALL_IMAGES).slice(0, pairCount);

      deck = shuffle([...picked, ...picked]).map((src, idx)=>({
        id: idx,
        src,
        matched:false
      }));

      deck.forEach((c)=>{
        const card = document.createElement('button');
        card.className = "card";
        card.type = "button";
        card.dataset.id = c.id;

        card.innerHTML = `
          <div class="cardInner">
            <div class="cardFace front"><div class="q">?</div></div>
            <div class="cardFace back">
              <div class="imgFrame">
                <img class="cardImg" src="${c.src}" alt="memory card" draggable="false" />
              </div>
            </div>
          </div>
        `;
        card.addEventListener('click', ()=> onFlip(card));
        board.appendChild(card);
      });
    }

    function flip(cardEl, on){ cardEl.classList.toggle('flipped', on); }
    function markMatched(cardEl){
      cardEl.classList.add('matched');
      cardEl.disabled = true;
      cardEl.setAttribute('aria-disabled','true');
    }

    // âœ… ì‹œì‘í•  ë•Œ 1ì´ˆ ì¹˜íŠ¸ ê³µê°œ
    function cheatRevealOneSecond(){
      const cards = board.querySelectorAll('.card');
      cards.forEach(c => c.classList.add('cheat'));
      setToast("ì¹˜íŠ¸ ë°œë™! 1ì´ˆë§Œ ì „ì²´ ê³µê°œ ğŸ˜");

      setTimeout(()=>{
        cards.forEach(c => c.classList.remove('cheat'));
        setToast("ì¹˜íŠ¸ ì¢…ë£Œ. ì´ì œ ì§„ì§œ ì‹¤ë ¥ ë³´ì—¬ì¤˜ ğŸ‘€");
      }, 1000);
    }

    function onFlip(cardEl){
      if(lock) return;

      const id = Number(cardEl.dataset.id);
      const card = deck[id];
      if(card.matched) return;
      if(cardEl === first) return;

      if(tries === 0 && matched === 0 && seconds === 0 && !timer){
        startTimer();
      }

      flip(cardEl, true);

      if(!first){
        first = cardEl;
        setToast("ì¢‹ì•„! í•˜ë‚˜ ë” ë’¤ì§‘ì–´ë´ ğŸ‘€");
        return;
      }

      second = cardEl;
      tries++;
      triesEl.textContent = tries;

      const a = deck[Number(first.dataset.id)].src;
      const b = deck[Number(second.dataset.id)].src;

      if(a === b){
        deck[Number(first.dataset.id)].matched = true;
        deck[Number(second.dataset.id)].matched = true;

        markMatched(first);
        markMatched(second);

        matched++;
        matchedEl.textContent = matched;
        setToast("ë§¤ì¹­ ì„±ê³µ! ğŸ¯");

        first = null; second = null;

        if(matched === currentPairCount){
          stopTimer();

          // âœ… Stageë³„ ìŠ¤í‹°ì»¤
          popSticker(STAGE_STICKER[currentLetterStage] || "ğŸ¥³");

          setToast("í´ë¦¬ì–´! ë‹¤ìŒ í¸ì§€ë¡œ ì´ë™í•œë‹¤â€¦ âœ¨");
          setTimeout(()=> advanceAfterWin(), 850);
        }
      } else {
        lock = true;
        setToast("ì•„ì‰½ë‹¤! ì ê¹ ë³´ì—¬ì¤„ê²Œ ğŸ˜");
        setTimeout(()=>{
          flip(first, false);
          flip(second, false);
          first = null;
          second = null;
          lock = false;
          setToast("ë‹¤ì‹œ! ì´ë²ˆì—” ë§ì¶œ ìˆ˜ ìˆì–´ ğŸ’ª");
        }, 750);
      }
    }

    function startGame(letterStage, pairCount){
      currentLetterStage = letterStage;
      currentPairCount = pairCount;

      gameTitle.textContent = `ğŸ§  Stage ${letterStage} ê¸°ì–µ ë§ì¶”ê¸° (${pairCount}ìŒ)`;
      resetStats(pairCount);
      first = null; second = null; lock = false;
      stopTimer();
      buildBoard(pairCount);
      setToast("ì¹´ë“œë¥¼ ë’¤ì§‘ì–´ ê°™ì€ ì‚¬ì§„ì„ ì°¾ì•„ë´!");
      showStage('stageGame');

      // âœ… ê²Œì„ ì‹œì‘ ì§í›„ ì¹˜íŠ¸ 1ì´ˆ ê³µê°œ
      setTimeout(cheatRevealOneSecond, 200);
    }

    function advanceAfterWin(){
      if(currentLetterStage === 1) showStage('stage2');
      else if(currentLetterStage === 2) showStage('stage3');
      else {
        showStage('stageEnd');
        fireConfetti();
      }
    }

    btnRestart.addEventListener('click', ()=> startGame(currentLetterStage, currentPairCount));
    btnCheer.addEventListener('click', ()=> setToast(cheerMsgs[Math.floor(Math.random()*cheerMsgs.length)]));
    btnBack.addEventListener('click', ()=>{
      if(currentLetterStage === 1) showStage('stage1');
      if(currentLetterStage === 2) showStage('stage2');
      if(currentLetterStage === 3) showStage('stage3');
      stopTimer();
    });

    // =============================
    // 6) Stage ë²„íŠ¼ë“¤
    // =============================
    document.getElementById('btnToGame1').addEventListener('click', ()=> startGame(1, 4));
    document.getElementById('btnToGame2').addEventListener('click', ()=> startGame(2, 6));
    document.getElementById('btnToGame3').addEventListener('click', ()=> startGame(3, 8));

    // =============================
    // 7) ì—”ë”© ë²„íŠ¼
    // =============================
    document.getElementById('btnAgain').addEventListener('click', ()=>{
      showStage('stage0');
      envelope.classList.remove('open');
      stopTimer();
    });

    // =============================
    // 8) Confetti
    // =============================
    const confetti = document.getElementById('confetti');
    function fireConfetti(){
      confetti.innerHTML = "";
      const count = 70;
      for(let i=0;i<count;i++){
        const p = document.createElement('div');
        p.className = "piece";
        const left = Math.random()*100;
        const delay = Math.random()*0.35;
        const dur = 2.6 + Math.random()*1.3;
        const rot = Math.random()*360;
        const w = 8 + Math.random()*10;
        const h = 10 + Math.random()*14;
        const hue = Math.floor(Math.random()*360);

        p.style.left = left + "vw";
        p.style.animationDelay = delay + "s";
        p.style.animationDuration = dur + "s";
        p.style.transform = `translateY(-20px) rotate(${rot}deg)`;
        p.style.width = w + "px";
        p.style.height = h + "px";
        p.style.background = `hsl(${hue} 90% 65%)`;
        confetti.appendChild(p);

        setTimeout(()=> p.remove(), (delay+dur)*1000 + 200);
      }
    }
  </script>
</body>
</html>
